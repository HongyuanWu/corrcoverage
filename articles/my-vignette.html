<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Correcting the Coverage of Credible Sets: <code>corrcov</code> â€¢ corrcoverage</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Correcting the Coverage of Credible Sets: &lt;code&gt;corrcov&lt;/code&gt;">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">corrcoverage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/New-Credible-Set.html">New Credible Set: `corrected_cs`</a>
    </li>
    <li>
      <a href="../articles/Useful-Info.html">Useful Info</a>
    </li>
    <li>
      <a href="../articles/my-vignette.html">Correcting the Coverage of Credible Sets: `corrcov`</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Correcting the Coverage of Credible Sets: <code>corrcov</code>
</h1>
                        <h4 class="author">Anna Hutchinson</h4>
            
            <h4 class="date">2019-07-25</h4>
      
      
      <div class="hidden name"><code>my-vignette.Rmd</code></div>

    </div>

    
    
<hr>
<p>This guide will show users how the <code>corrcoverage</code> package can be used for statistical fine-mapping, including obtaining an accurate coverage estimate for the causal variant in a credible set (corrected coverage estimate). This package is specific to credible sets obtained using the Bayesian approach to fine-mapping, described by Maller et al. <a href="https://www.ncbi.nlm.nih.gov/pubmed/23104008">here</a>, which utilities Bayes factors for genetic association studies described by Wakefield <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/gepi.20359">here</a>.</p>
<p>The <code>corrcoverage</code> package uses GWAS summary statistics to provides an accurate estimate of the probability that the true causal variant is contained within a credible set derived for a given threshold. It also provides functions so that users can move freely between joint Z-scores, marginal Z-scores, asymptotic Bayes factors and posterior probabilities of causality.</p>
<hr>
<p>Load the library.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(corrcoverage)</a></code></pre></div>
<hr>
<div id="simulate-gwas-summary-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-gwas-summary-statistics" class="anchor"></a>Simulate GWAS summary statistics</h2>
<hr>
<p><strong>This package is intended for use on summary statistics obtained from GWAS, such as observed <span class="math inline">\(Z\)</span>-scores. For the purpose of this vignette, we will simulate artificial haplotypes and GWAS data using the <a href="https://github.com/chr1swallace/simGWAS">simGWAS</a> package. Please refer to the walkthrough guide <a href="https://chr1swallace.github.io/simGWAS/articles/intro.html">here</a> from which the following is taken.</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(simGWAS)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Simulate reference haplotypes</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">nsnps &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">nhaps &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">lag &lt;-<span class="st"> </span><span class="dv">5</span> <span class="co"># genotypes are correlated between neighbouring variants</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">maf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(nsnps<span class="op">+</span>lag,<span class="fl">0.05</span>,<span class="fl">0.5</span>) <span class="co"># common SNPs</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">laghaps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(<span class="st">"cbind"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(maf, <span class="cf">function</span>(f) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Binomial">rbinom</a></span>(nhaps,<span class="dv">1</span>,f)))</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">haps &lt;-<span class="st"> </span>laghaps[,<span class="dv">1</span><span class="op">:</span>nsnps]</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>lag) </a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    haps &lt;-<span class="st"> </span>haps <span class="op">+</span><span class="st"> </span>laghaps[,(<span class="dv">1</span><span class="op">:</span>nsnps)<span class="op">+</span>j]</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">haps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(haps<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(haps,<span class="dv">2</span>,max),nhaps,nsnps,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">snps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(haps) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"s"</span>,<span class="dv">1</span><span class="op">:</span>nsnps)</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">freq &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(haps<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">freq<span class="op">$</span>Probability &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(freq)</a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(freq<span class="op">$</span>Probability)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">MAF &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colMeans</a></span>(freq[,snps]<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co"># SNP correlation matrix</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">LD &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cor2.html">cor2</a></span>(haps)</a></code></pre></div>
<p>We specify the causal variant (CV) and itâ€™s effect on disease, as an odds ratio. One causal variant is chosen since the Bayesian approach to fine-mapping relies on the assumption of one causal variant per region, which is typed in the study.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">CV &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(snps[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colMeans</a></span>(haps)<span class="op">&gt;</span><span class="fl">0.1</span>)],<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">iCV &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">sub</a></span>(<span class="st">"s"</span>, <span class="st">""</span>, CV) <span class="co"># index of cv</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">OR &lt;-<span class="st"> </span><span class="fl">1.1</span></a></code></pre></div>
<p>Then, we simulate marginal <span class="math inline">\(Z\)</span>-scores. Here, we consider a (fairly small) GWAS with 5000 cases and 5000 controls.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">z0 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/simGWAS/topics/simulated_z_score">simulated_z_score</a></span>(<span class="dt">N0=</span><span class="dv">5000</span>, <span class="co"># number of controls</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">              <span class="dt">N1=</span><span class="dv">5000</span>, <span class="co"># number of cases</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">              <span class="dt">snps=</span>snps, <span class="co"># column names in freq of SNPs for which Z scores should be generated</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">              <span class="dt">W=</span>CV, <span class="co"># causal variants, subset of snps</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">              <span class="dt">gamma.W=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(OR), <span class="co"># log odds ratios</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">              <span class="dt">freq=</span>freq <span class="co"># reference haplotypes</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">              )</a></code></pre></div>
<hr>
</div>
<div id="find-a-credible-set" class="section level2">
<h2 class="hasAnchor">
<a href="#find-a-credible-set" class="anchor"></a>Find a credible set</h2>
<hr>
<p>We now use the <code>credset</code> function in the <code>corrcoverage</code> package to obtain a credible set using the Bayesian approach for fine-mapping. In brief, the function follows the standard steps from Maller et al.â€™s approach:</p>
<ol style="list-style-type: decimal">
<li>Order variants into descending order of posterior probabilities.</li>
<li>Cumulatively sum the PPs for these variants until the specified threshold is exceeded.</li>
<li>Group these variants to form the credible set.</li>
</ol>
<p>The function requires posterior probabilities of causality as an input, and so we use the <code>ppfunc</code> function to convert the marginal <span class="math inline">\(Z\)</span>-scores to posterior probabilities of causality. The <code>ppfunc</code> function also requires a value for <span class="math inline">\(V\)</span>, the variance of the estimated effect size, which can be easily calculated using the <code>Var.data.cc</code> function. The prior standard deviation of the effect size, <span class="math inline">\(W\)</span>, is an optional parameter with a default value of 0.2, which is shown to be a robust choice through our analyses.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">N0 &lt;-<span class="st"> </span><span class="dv">5000</span> <span class="co"># number of controls</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">N1 &lt;-<span class="st"> </span><span class="dv">5000</span> <span class="co"># number of cases</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">varbeta &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Var.data.cc.html">Var.data.cc</a></span>(<span class="dt">f =</span> MAF, <span class="dt">N =</span> N1<span class="op">+</span>N0, <span class="dt">s =</span> N1<span class="op">/</span>(N0<span class="op">+</span>N1)) <span class="co"># variance of estimated effect size</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">postprobs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ppfunc.html">ppfunc</a></span>(<span class="dt">z =</span> z0, <span class="dt">V =</span> varbeta)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(postprobs, <span class="dt">main =</span> <span class="st">"Posterior probabilities of causality"</span>, <span class="dt">xlab =</span> <span class="st">"SNP index"</span>, <span class="dt">ylab =</span> <span class="st">"Posterior probability"</span>)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">v =</span> iCV, <span class="dt">col =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="my-vignette_files/figure-html/unnamed-chunk-6-1.png" width="384"></p>
<p>The posterior probability plot shows the location of the causal variant (red line). Notice that the causal variant is not the variant with the largest posterior probability. This is not rare in fine-mapping analyses and occurs due to linkage disequilibrium patterns (correlation between SNPs).</p>
<p>The <code>credset</code> function reports the variants in the credible set, the claimed coverage<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> (the sum of the posterior probabilities of the variants in the set) and the number of variants in the credible set (nvar). If the <code>CV</code> parameter is supplied by the user (e.g.Â in simulation studies where the CV is known), then the output also includes a binary indicator of whether the causal variant was contained in the credible set.</p>
<p>We use the <code>credset</code> function to obtain a 90% credible set.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">thresh &lt;-<span class="st"> </span><span class="fl">0.9</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">credibleset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/credset.html">credset</a></span>(<span class="dt">pp =</span> postprobs, <span class="dt">thr =</span> thresh)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">credibleset</a></code></pre></div>
<pre><code>## $credset
##   [1]  49  48  46  11 125 126  44  45 153 185 128 107   1 152  10 119 149 190  30  43  12  62  60  61 184  42 154 127 186 180  93  94  53  72 189 124  16  17 123  91  70 106  55 183 130 191 139  24 151 112  97  40  83  57  95  47  58  50  32  69  92 187  52 113 181 175  78  21 111 134 135 179   2 150 129  96   3 195  84  68  90 103 144 146  66  63  51 104 108  18 194  71 147  81  80 188   6 101  27   4  34 174 196 161  67   8 159  26 170 140 109  38  31  87 176
## 
## $claimed.cov
## [1] 0.9006078
## 
## $nvar
## [1] 115</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">thresh &lt;-<span class="st"> </span><span class="fl">0.9</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">credibleset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/credset.html">credset</a></span>(<span class="dt">pp =</span> postprobs, <span class="dt">CV =</span> iCV, <span class="dt">thr =</span> thresh)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">credibleset</a></code></pre></div>
<pre><code>## $credset
##   [1]  49  48  46  11 125 126  44  45 153 185 128 107   1 152  10 119 149 190  30  43  12  62  60  61 184  42 154 127 186 180  93  94  53  72 189 124  16  17 123  91  70 106  55 183 130 191 139  24 151 112  97  40  83  57  95  47  58  50  32  69  92 187  52 113 181 175  78  21 111 134 135 179   2 150 129  96   3 195  84  68  90 103 144 146  66  63  51 104 108  18 194  71 147  81  80 188   6 101  27   4  34 174 196 161  67   8 159  26 170 140 109  38  31  87 176
## 
## $claimed.cov
## [1] 0.9006078
## 
## $covered
## [1] 1
## 
## $nvar
## [1] 115</code></pre>
<p>Here, the 90% credible set contains many variants, has a claimed coverage of ~90% and contains the true causal variant. In the literature, authors would typically report that they have found a 90% credible set which they are at least 90% confident contains the true causal variant.</p>
<p>Note that if the variants are named in the <code>pp</code> vector, then the <code>$credset</code> output would contain variant names rather than their indices.</p>
<hr>
</div>
<div id="corrected-coverage-estimate" class="section level2">
<h2 class="hasAnchor">
<a href="#corrected-coverage-estimate" class="anchor"></a>Corrected coverage estimate</h2>
<p>Suppose we are suspicious of this coverage estimate (90% in our example) and wish to find a more accurate estimate using this fancy new package. The <code>corrcov</code> function can be used, which requires the following parameters:</p>
<ul>
<li>
<code>z</code> (marginal <span class="math inline">\(Z\)</span>-scores)</li>
<li>
<code>f</code> (minor allele frequencies)</li>
<li>
<code>N0</code>, <code>N1</code> (number of controls and cases respectively)</li>
<li>
<code>Sigma</code> (SNP correlation matrix)</li>
<li>
<code>thr</code> (threshold used to derive the credible set)</li>
</ul>
<p>Side note: If the estimated effect size coefficients (<code>bhat</code>) and their standard errors (<code><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt(V)</a></code>) are known instead of <span class="math inline">\(Z\)</span>-scores and minor allele frequencies, then the <code>corrcov_bhat</code> function can be used analogously.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">corrected_cov_estimate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/corrcov.html">corrcov</a></span>(<span class="dt">z =</span> z0, <span class="dt">f =</span> MAF, N0, N1, <span class="dt">Sigma =</span> LD, <span class="dt">thr =</span> thresh)</a></code></pre></div>
<pre><code>##  Corrected.Coverage Claimed.Coverage Threshold
##           0.9685066        0.9006078       0.9</code></pre>
<p>In this example, the 90% credible set may in actual fact have nearer to 97% coverage of the causal variant in the credible set.</p>
<hr>
</div>
<div id="compare-with-estimate-of-true-coverage" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-with-estimate-of-true-coverage" class="anchor"></a>Compare with estimate of â€˜trueâ€™ coverage</h2>
<p>For the purpose of this vignette and to see the accuracy of this corrected coverage estimate, we simulate more credible sets from the same system and calculate what proportion of these contain the true causal variant.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">z0.tmp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/simGWAS/topics/simulated_z_score">simulated_z_score</a></span>(<span class="dt">N0=</span><span class="dv">5000</span>, <span class="co"># number of controls</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">                            <span class="dt">N1=</span><span class="dv">5000</span>, <span class="co"># number of cases</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">                            <span class="dt">snps=</span>snps, <span class="co"># column names in freq</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">                            <span class="dt">W=</span>CV, <span class="co"># causal variants, subset of snps</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">                            <span class="dt">gamma.W=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(OR), <span class="co"># log odds ratios</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">                            <span class="dt">freq=</span>freq, <span class="co"># reference haplotypes</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">                            <span class="dt">nrep =</span> <span class="dv">5000</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9"></a>
<a class="sourceLine" id="cb15-10" data-line-number="10">pps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ppfunc.mat.html">ppfunc.mat</a></span>(<span class="dt">zstar =</span> z0.tmp, <span class="dt">V =</span> varbeta) <span class="co"># find pps from a matrix of simulations</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11">cs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(pps, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw"><a href="../reference/credset.html">credset</a></span>(x, <span class="dt">CV =</span> iCV, <span class="dt">thr =</span> thresh)<span class="op">$</span>cov)</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">true.cov.est &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(cs)</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">true.cov.est</a></code></pre></div>
<pre><code>## [1] 0.969</code></pre>
<p>The estimated empirical coverage is found to be approximately 97%, so our corrected coverage estimate is accurate - far more so than the standard â€˜claimed coverageâ€™ of ~90%.</p>
<pre><code>##  Empirical.Coverage Corrected.Coverage Claimed.Coverage Threshold
##               0.969          0.9685066        0.9006078       0.9</code></pre>
<hr>
</div>
<div id="so-what" class="section level2">
<h2 class="hasAnchor">
<a href="#so-what" class="anchor"></a>So what?</h2>
<p>This vignette has shown readers how to use the <code>corrcoverage</code> package to obtain a more accurate coverage estimate of the causal variant in a credible set. Obtaining accurate coverage estimates will allow researchers to adjust their credible set to achieve the true desired coverage - for example narrowing down a 95% credible set of 10 variants to just 5 variants. Moreover, reporting an accurate coverage estimate of the causal variant in a credible set will allow for more efficient allocation and expenditure of resources in the laborious follow-up wet lab analyses of the variants in the credible set. Altogether, this procedure will improve the efficiency of determining the genes and pathways which play a role in human disease, ultimately helping to untangle the complex relationship between genetic variants and disease.</p>
<hr>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p><a href="https://www.ncbi.nlm.nih.gov/pubmed/23104008">Maller et al., 2013</a> Maller, J. B. et al.Â Bayesian refinement of association signals for 14 loci in 3 common diseases. Nature Genet. 44, 1294â€“1301 (2012)</p>
<p><a href="https://github.com/chr1swallace/simGWAS">simGWAS</a>: Mary D Fortune, Chris Wallace; simGWAS: a fast method for simulation of large scale caseâ€“control GWAS summary statistics, Bioinformatics, bty898 (2018)</p>
<p><a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/gepi.20359">Wakefield, 2009</a> Wakefield, J. Bayes factors for genome-wide association studies: comparison with P-values. Genet. Epidemiol. 33, 79â€“86 (2009)</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Researchers commonly use the size of the credible set as an estimate of the coverage probability of the causal variant in the set. It is believed to be a slightly better indicator of coverage than the threshold (claimed coverage &gt; threshold by virtue of the method).<a href="#fnref1" class="footnote-back">â†©</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simulate-gwas-summary-statistics">Simulate GWAS summary statistics</a></li>
      <li><a href="#find-a-credible-set">Find a credible set</a></li>
      <li><a href="#corrected-coverage-estimate">Corrected coverage estimate</a></li>
      <li><a href="#compare-with-estimate-of-true-coverage">Compare with estimate of â€˜trueâ€™ coverage</a></li>
      <li><a href="#so-what">So what?</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Anna Hutchinson, Chris Wallace.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
